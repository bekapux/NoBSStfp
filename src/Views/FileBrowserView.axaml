<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:NoBSSftp.ViewModels"
             xmlns:models="using:NoBSSftp.Models"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="NoBSSftp.Views.FileBrowserView"
             x:DataType="vm:SessionViewModel"
             x:Name="FileBrowserRoot"
             FontFamily="Menlo,Consolas,Courier New"
             DragDrop.AllowDrop="True">
    <Grid x:Name="RootGrid" Background="#1E1E1E">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Connection Bar -->
        <StackPanel Grid.Row="0" Spacing="6" Margin="5,10,5,5"
            IsVisible="{Binding !IsConnected}"
            IsEnabled="{Binding !IsConnecting}">
            <StackPanel Orientation="Horizontal" Spacing="5">
                <TextBox Text="{Binding Profile.Host}" Watermark="Host" Width="150" />
                <TextBox Text="{Binding Profile.Username}" Watermark="User" Width="100" />
                <TextBox x:Name="ConnectPasswordBox" Text="{Binding Profile.Password}" Watermark="Password" PasswordChar="*"
                    Width="100" IsVisible="{Binding !Profile.UsePrivateKey}" />
                <CheckBox Content="Key" IsChecked="{Binding Profile.UsePrivateKey}" VerticalAlignment="Center"/>
                <TextBox x:Name="ConnectKeyPathBox" Text="{Binding Profile.PrivateKeyPath}" Watermark="Key path" Width="180"
                    IsVisible="{Binding Profile.UsePrivateKey}" />
                <Button Content="Browse..." IsVisible="{Binding Profile.UsePrivateKey}"
                    Click="OnPickKeyPathClicked" />
                <TextBox x:Name="ConnectKeyPassphraseBox" Text="{Binding Profile.PrivateKeyPassphrase}" Watermark="Key passphrase"
                    PasswordChar="*" Width="140" IsVisible="{Binding Profile.UsePrivateKey}" />
                <Button Command="{Binding ConnectCommand}" Content="Connect" />
            </StackPanel>
        </StackPanel>

        <!-- Navigation Bar -->
        <StackPanel Grid.Row="1" Spacing="6" Margin="5,10,5,5"
                    IsVisible="{Binding IsConnected}">
            <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,*,Auto"
                  ColumnSpacing="5"
                  HorizontalAlignment="Stretch">
                <TextBox Grid.Column="0" Text="{Binding CurrentPath}" Width="300" />
                <Button Grid.Column="1" Command="{Binding RefreshFileListCommand}" Content="Refresh" />
                <Button Grid.Column="2"
                        Command="{Binding DisconnectCommand}"
                        Content="Disconnect"
                        Background="#CC3333"
                        Foreground="White" />
                <Button Grid.Column="3" Content="Create...">
                    <Button.Flyout>
                        <MenuFlyout>
                            <MenuItem Header="File" Command="{Binding CreateFileCommand}" />
                            <MenuItem Header="Folder" Command="{Binding CreateFolderCommand}" />
                        </MenuFlyout>
                    </Button.Flyout>
                </Button>
                <ToggleButton Grid.Column="4"
                              IsChecked="{Binding ShowHiddenFiles}"
                              ToolTip.Tip="Show Hidden Files"
                              Padding="6">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="ðŸ‘ï¸" VerticalAlignment="Center"/>
                        <TextBlock Text="Hidden" VerticalAlignment="Center"/>
                    </StackPanel>
                </ToggleButton>
                <CheckBox Grid.Column="5"
                          Content="Verify"
                          IsChecked="{Binding VerifyTransfersAfterTransfer}"
                          VerticalAlignment="Center"
                          ToolTip.Tip="Verify upload/download integrity after transfer (SHA-256 for files up to 64 MB; larger files use size/time fallback)"/>
                <Button Grid.Column="7"
                        Command="{Binding OpenExternalTerminalCommand}"
                        ToolTip.Tip="Open OS Terminal"
                        Padding="6">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <TextBlock Text="ðŸ’»" VerticalAlignment="Center"/>
                        <TextBlock Text="Terminal" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </Grid>

            <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,Auto,*,Auto,Auto"
                  ColumnSpacing="6"
                  HorizontalAlignment="Stretch">
                <TextBlock Grid.Column="0"
                           Text="Search:"
                           VerticalAlignment="Center"
                           Foreground="#A0A0A0"/>
                <TextBox Grid.Column="1"
                         Width="320"
                         Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                         Watermark="Filter current folder (or entire tree with Recursive)"/>
                <Button Grid.Column="2"
                        Content="Clear"
                        Command="{Binding ClearSearchCommand}"/>
                <CheckBox Grid.Column="3"
                          Content="Recursive"
                          IsChecked="{Binding SearchRecursive}"
                          VerticalAlignment="Center"/>
                <ProgressBar Grid.Column="4"
                             Width="90"
                             Height="6"
                             IsIndeterminate="True"
                             IsVisible="{Binding IsSearchInProgress}"
                             VerticalAlignment="Center"/>
                <TextBlock Grid.Column="6"
                           Margin="14,0,0,0"
                           Text="View:"
                           VerticalAlignment="Center"
                           Foreground="#A0A0A0"/>
                <ComboBox Grid.Column="7"
                          Width="118"
                          Margin="4,0,0,0"
                          ItemsSource="{Binding ExplorerViewOptions}"
                          SelectedItem="{Binding SelectedExplorerView}"/>
            </Grid>
        </StackPanel>

        <!-- Connected File Explorer -->
        <Grid Grid.Row="2" RowDefinitions="*, Auto" IsVisible="{Binding IsConnected}">
            <Border Grid.Row="0" Background="Transparent" Margin="5" BorderThickness="1"
                BorderBrush="Gray">
                <Border.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Paste" Command="{Binding PasteCommand}"/>
                        <Separator/>
                        <MenuItem Header="Create File" Command="{Binding CreateFileCommand}"/>
                        <MenuItem Header="Create Folder" Command="{Binding CreateFolderCommand}"/>
                        <Separator/>
                        <MenuItem Header="Refresh" Command="{Binding RefreshFileListCommand}"/>
                    </ContextMenu>
                </Border.ContextMenu>

                <Grid>
                    <DataGrid x:Name="FileGrid" ItemsSource="{Binding Files}"
                              SelectedItem="{Binding SelectedFile}"
                              IsVisible="{Binding IsListView}"
                              IsReadOnly="True"
                              SelectionMode="Extended"
                              GridLinesVisibility="All"
                              BorderThickness="0"
                              SelectionChanged="OnSelectionChanged"
                              DoubleTapped="OnDataGridDoubleTapped"
                              DragDrop.AllowDrop="True">

                        <!-- Styles to apply Context Menu to Rows -->
                        <DataGrid.Styles>
                            <Style Selector="DataGridRow">
                                <Setter Property="ContextMenu">
                                    <Setter.Value>
                                        <ContextMenu x:DataType="models:FileEntry">
                                            <MenuItem Header="Download To..."
                                                      Command="{Binding #FileBrowserRoot.DataContext.DownloadToCommand}"
                                                      CommandParameter="{Binding}"/>
                                            <Separator/>
                                            <MenuItem Header="Copy"
                                                      Command="{Binding #FileBrowserRoot.DataContext.CopyCommand}"
                                                      CommandParameter="{Binding}"/>
                                            <MenuItem Header="Cut"
                                                      Command="{Binding #FileBrowserRoot.DataContext.CutCommand}"
                                                      CommandParameter="{Binding}"/>
                                            <MenuItem Header="Paste Into"
                                                      Command="{Binding #FileBrowserRoot.DataContext.PasteIntoCommand}"
                                                      CommandParameter="{Binding}"
                                                      IsEnabled="{Binding IsDirectory}"/>
                                            <MenuItem Header="Paste"
                                                      Command="{Binding #FileBrowserRoot.DataContext.PasteCommand}"/>
                                            <Separator/>
                                            <!-- Bind to named element's DataContext to avoid RelativeSource issues.
                                                 Pass current row's DataContext (FileEntry) as Parameter. -->
                                            <MenuItem Header="Rename"
                                                      Command="{Binding #FileBrowserRoot.DataContext.RenameCommand}"
                                                      CommandParameter="{Binding}"/>
                                            <MenuItem Header="Delete"
                                                      Command="{Binding #FileBrowserRoot.DataContext.DeleteCommand}"
                                                      CommandParameter="{Binding}"/>
                                            <Separator/>
                                            <MenuItem Header="Properties..."
                                                      Command="{Binding #FileBrowserRoot.DataContext.ShowPropertiesCommand}"
                                                      CommandParameter="{Binding}"/>
                                        </ContextMenu>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                            <Style Selector="DataGridRow.DropTargetRow">
                                <Setter Property="Background" Value="#2A4AA3FF"/>
                            </Style>
                        </DataGrid.Styles>

                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Name" Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="10" Margin="5,0"
                                                    Background="Transparent"
                                                    PointerPressed="OnRowPointerPressed"
                                                    PointerMoved="OnRowPointerMoved"
                                                    PointerReleased="OnRowPointerReleased"
                                                    DragDrop.AllowDrop="True"
                                                    DragDrop.DragOver="OnRowDragOver"
                                                    DragDrop.Drop="OnRowDrop">
                                            <!-- Folder Icon -->
                                            <TextBlock Text="ðŸ“" Foreground="#E8A87C"
                                                       IsVisible="{Binding ShowDirectoryIcon}"
                                                       Width="20" Height="20"
                                                       VerticalAlignment="Center"
                                                       TextAlignment="Center"/>
                                            <!-- File Icon -->
                                            <TextBlock Text="ðŸ“„" Foreground="Gray"
                                                       IsVisible="{Binding ShowFileIcon}"
                                                       Width="20" Height="20"
                                                       VerticalAlignment="Center"
                                                       TextAlignment="Center"/>
                                            <!-- Symlink Icon -->
                                            <TextBlock Text="ðŸ”—" Foreground="#F2C14E"
                                                       IsVisible="{Binding ShowSymlinkIcon}"
                                                       Width="20" Height="20"
                                                       VerticalAlignment="Center"
                                                       TextAlignment="Center"/>
                                            <TextBlock Text="{Binding NameDisplay}" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeDisplay}"
                                                Width="Auto" />
                            <DataGridTextColumn Header="Date" Binding="{Binding DateDisplay}"
                                                Width="Auto" />
                        </DataGrid.Columns>
                    </DataGrid>

                    <Grid IsVisible="{Binding IsTreeView}" RowDefinitions="Auto,*">
                        <Border Grid.Row="0"
                                BorderThickness="0,0,0,1"
                                BorderBrush="#2E2E2E"
                                Padding="8,4">
                            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="14">
                                <TextBlock Grid.Column="0" Text="Name" FontWeight="SemiBold" Foreground="#D0D0D0"/>
                                <TextBlock Grid.Column="1" Text="Size" FontWeight="SemiBold" Foreground="#D0D0D0"/>
                                <TextBlock Grid.Column="2" Text="Date" FontWeight="SemiBold" Foreground="#D0D0D0"/>
                            </Grid>
                        </Border>

                        <TreeView Grid.Row="1"
                                  x:Name="RemoteTreeView"
                                  ItemsSource="{Binding TreeItems}"
                                  SelectedItem="{Binding SelectedTreeNode}"
                                  DoubleTapped="OnTreeViewDoubleTapped">
                            <TreeView.Styles>
                                <Style Selector="TreeViewItem.DropTargetRow">
                                    <Setter Property="Background" Value="#2A4AA3FF"/>
                                </Style>
                            </TreeView.Styles>
                            <TreeView.ItemTemplate>
                                <TreeDataTemplate x:DataType="models:RemoteTreeNode"
                                                  ItemsSource="{Binding Children}">
                                    <Grid ColumnDefinitions="*,Auto,Auto"
                                          ColumnSpacing="14"
                                          PointerPressed="OnRowPointerPressed"
                                          PointerMoved="OnRowPointerMoved"
                                          PointerReleased="OnRowPointerReleased"
                                          DragDrop.AllowDrop="True"
                                          DragDrop.DragOver="OnRowDragOver"
                                          DragDrop.Drop="OnRowDrop">
                                        <Grid.ContextMenu>
                                            <ContextMenu x:DataType="models:RemoteTreeNode">
                                                <MenuItem Header="Properties..."
                                                          Command="{Binding #FileBrowserRoot.DataContext.ShowPropertiesCommand}"
                                                          CommandParameter="{Binding Entry}"
                                                          IsEnabled="{Binding !IsPlaceholder}"/>
                                            </ContextMenu>
                                        </Grid.ContextMenu>
                                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="ðŸ“"
                                                       Foreground="#E8A87C"
                                                       IsVisible="{Binding ShowDirectoryIcon}"
                                                       Width="20"
                                                       Height="20"
                                                       VerticalAlignment="Center"
                                                       TextAlignment="Center"/>
                                            <TextBlock Text="ðŸ“„"
                                                       Foreground="Gray"
                                                       IsVisible="{Binding ShowFileIcon}"
                                                       Width="20"
                                                       Height="20"
                                                       VerticalAlignment="Center"
                                                       TextAlignment="Center"/>
                                            <TextBlock Text="ðŸ”—"
                                                       Foreground="#F2C14E"
                                                       IsVisible="{Binding ShowSymlinkIcon}"
                                                       Width="20"
                                                       Height="20"
                                                       VerticalAlignment="Center"
                                                       TextAlignment="Center"/>
                                            <TextBlock Text="{Binding NameDisplay}"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="â€¦"
                                                       Foreground="#8A929B"
                                                       IsVisible="{Binding IsLoading}"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding SizeDisplay}"
                                                   Foreground="#C0C0C0"
                                                   VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding DateDisplay}"
                                                   Foreground="#C0C0C0"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </TreeDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </Grid>

                    <!-- Drag Overlay -->
                    <Border x:Name="DragOverlay" Background="#99000000" IsVisible="False"
                        IsHitTestVisible="False">
                        <TextBlock Text="Drop files to upload" Foreground="White" FontSize="24"
                            HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" />
                    </Border>

                    <!-- Transfer Progress UI -->
                    <Border Background="#333333" BorderBrush="Black" BorderThickness="1"
                        CornerRadius="0"
                        HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="20" Padding="15"
                        IsVisible="{Binding IsTransferring}" Width="400" BoxShadow="0 4 10 0 #50000000">
                        <StackPanel Spacing="10">
                            <TextBlock Text="{Binding TransferTitle}" FontWeight="Bold"
                                Foreground="White"
                                HorizontalAlignment="Center" TextTrimming="CharacterEllipsis" />

                            <ProgressBar Minimum="0" Maximum="100" Value="{Binding TransferProgress}"
                                Height="10"
                                Foreground="#007ACC" Background="#555555" />

                            <Button Content="Cancel" Command="{Binding CancelTransferCommand}"
                                HorizontalAlignment="Center" Foreground="White" Background="#CC3333" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Status + Transfer Queue -->
            <StackPanel Grid.Row="1" Margin="5" Spacing="4">
                <TextBlock Text="{Binding StatusMessage}" Foreground="Gray" />
                <Border IsVisible="{Binding IsTransferQueueVisible}"
                        BorderThickness="1"
                        BorderBrush="#343434"
                        Background="#171717"
                        Padding="6">
                    <StackPanel Spacing="4">
                        <TextBlock Text="{Binding TransferQueueSummary}" Foreground="#8A929B" FontSize="11"/>
                        <TextBlock Text="No transfers yet"
                                   Foreground="#6F7680"
                                   FontSize="10"
                                   IsVisible="{Binding !HasTransferJobs}"/>
                        <ScrollViewer Height="136"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled">
                            <ItemsControl ItemsSource="{Binding TransferJobs}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="models:TransferJob">
                                        <Grid ColumnDefinitions="*,Auto,Auto"
                                              ColumnSpacing="8"
                                              Margin="0,1">
                                            <StackPanel Grid.Column="0" Spacing="1">
                                                <TextBlock Text="{Binding Title}"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Text="{Binding Status}"
                                                           FontSize="10"
                                                           Foreground="#8A929B"
                                                           TextTrimming="CharacterEllipsis"/>
                                            </StackPanel>
                                            <TextBlock Grid.Column="1"
                                                       Text="{Binding StateLabel}"
                                                       FontSize="10"
                                                       Foreground="#8A929B"
                                                       VerticalAlignment="Center"/>
                                            <Button Grid.Column="2"
                                                    Content="Retry"
                                                    Padding="6,2"
                                                    Command="{Binding #FileBrowserRoot.DataContext.RetryTransferCommand}"
                                                    CommandParameter="{Binding}"
                                                    IsVisible="{Binding IsRetryable}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Disconnected Suggestions -->
        <Grid Grid.Row="2" IsVisible="{Binding !IsConnected}" Margin="5" IsEnabled="{Binding !IsConnecting}">
            <TextBlock IsVisible="{Binding !HasSuggestedServerPrimary}"
                       Text="No saved servers"
                       FontSize="12"
                       Foreground="#8A929B"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>

            <Grid IsVisible="{Binding HasSingleSuggestedServer}"
                  ColumnDefinitions="*,Auto,*"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Center">
                <Button Grid.Column="1"
                        Width="190"
                        Height="190"
                        Command="{Binding ConnectSuggestionCommand}"
                        CommandParameter="{Binding SuggestedServerPrimary}"
                        CornerRadius="0"
                        Background="#101010"
                        BorderBrush="#2A2A2A"
                        BorderThickness="1">
                    <StackPanel Spacing="8"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <TextBlock Text="ðŸ–¥ï¸"
                                   Width="28"
                                   Height="28"
                                   Foreground="#9AA4B1"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"/>
                        <TextBlock Text="{Binding SuggestedServerPrimary.Name}"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding SuggestedServerPrimary.Host}"
                                   FontSize="11"
                                   Foreground="#8A929B"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding SuggestedServerPrimary.Username}"
                                   FontSize="11"
                                   Foreground="#8A929B"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </Button>
            </Grid>

            <Grid IsVisible="{Binding HasTwoSuggestedServers}"
                  ColumnDefinitions="*,Auto,*,Auto,*"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Center">
                <Button Grid.Column="1"
                        Width="190"
                        Height="190"
                        Command="{Binding ConnectSuggestionCommand}"
                        CommandParameter="{Binding SuggestedServerPrimary}"
                        CornerRadius="0"
                        Background="#101010"
                        BorderBrush="#2A2A2A"
                        BorderThickness="1">
                    <StackPanel Spacing="8"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <TextBlock Text="ðŸ–¥ï¸"
                                   Width="28"
                                   Height="28"
                                   Foreground="#9AA4B1"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"/>
                        <TextBlock Text="{Binding SuggestedServerPrimary.Name}"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding SuggestedServerPrimary.Host}"
                                   FontSize="11"
                                   Foreground="#8A929B"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding SuggestedServerPrimary.Username}"
                                   FontSize="11"
                                   Foreground="#8A929B"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </Button>

                <Button Grid.Column="3"
                        Width="190"
                        Height="190"
                        Command="{Binding ConnectSuggestionCommand}"
                        CommandParameter="{Binding SuggestedServerSecondary}"
                        CornerRadius="0"
                        Background="#101010"
                        BorderBrush="#2A2A2A"
                        BorderThickness="1">
                    <StackPanel Spacing="8"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <TextBlock Text="ðŸ–¥ï¸"
                                   Width="28"
                                   Height="28"
                                   Foreground="#9AA4B1"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"/>
                        <TextBlock Text="{Binding SuggestedServerSecondary.Name}"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding SuggestedServerSecondary.Host}"
                                   FontSize="11"
                                   Foreground="#8A929B"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                        <TextBlock Text="{Binding SuggestedServerSecondary.Username}"
                                   FontSize="11"
                                   Foreground="#8A929B"
                                   HorizontalAlignment="Center"
                                   TextAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Grid>

        <Border Grid.Row="2"
                IsVisible="{Binding IsConnecting}"
                Background="#66000000"
                Margin="5">
            <StackPanel Spacing="10"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True"
                             Width="140"
                             Height="8"/>
                <TextBlock Text="Connecting..."
                           FontSize="12"
                           Foreground="#D0D0D0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

    </Grid>
</UserControl>
